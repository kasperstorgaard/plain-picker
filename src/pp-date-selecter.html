<link rel="import" href="../../polymer/polymer.html">

<dom-module id="pp-date-selecter">
    <script>
        Polymer({
            is: 'pp-date-selecter',
            properties: {
                dates: {
                    type: Array,
                    value: () => [],
                    notify: true
                },
                lastSelected: {
                    type: Object,
                    value: null,
                    computed: '_getLastSelected(dates.*)',
                    notify: true
                },
                max: {
                    type: Number,
                    value: 1
                },
                _stack: {
                    type: Array,
                    value: () => []
                }
            },

            observers: [
                '_buildDates(_stack.*, max)'
            ],

            select (date) {
                if (!date || typeof date !== 'object' || !(date instanceof Date)) {
                    throw new Error('must provide a valid date to .select()');
                }
                this.unshift('_stack', date);
                return this.dates;
            },

            reset () {
                this.set('dates', []);
            },

            _buildDates (stackMutations, max) {
                const cut = this._stack.slice(0, max);
                const ordered = cut.sort((a, b) => a.valueOf() >= b.valueOf());
                this.set('dates', ordered);
            },

            _getLastSelected () {
                return this.dates[0] || null;
            }
        });
    </script>
</dom-module>
